<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=, initial-scale=1.0" />
    <title>Document</title>
    <style>
      body {
        padding-top: 100px;

        background-color: #000316;
        color: white;
        font-family: Arial, Helvetica, sans-serif;
        font-weight: 900;
      }
      .container {
        width: 50%;
        margin: auto;
      }
      .count {
        display: flex;
        column-gap: 15%;
      }
      input,
      textarea {
        width: 100%;
        display: block;
        overflow-x: auto;
      }
      form {
        width: 89%;
      }
      button {
        padding: 5px 7px 5px 7px;
        margin-top: 20px;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <form>
        <label for="name">Sender's ID</label>
        <input type="text" id="sender_id" /><br /><br />
        <label for="Phone">Phone Number</label>
        <input type="file" id="phone" onchange="readTextFile()" />

        <p><label for="message">Type your message below:</label></p>
        <textarea
          class="smsField"
          name=""
          id="message"
          cols="30"
          rows="10"
          onkeyup="charCount(this)"
        ></textarea>
        <button type="button" id="sendBtn" onclick="sendSms()">Send</button>
      </form>

      <div class="count">
        <p id="charNum">Character entered : 0</p>
        <p id="pgc">Number of pages : 1</p>
        <p id="price">Cost : 2</p>
      </div>
    </div>
    <script>
      function charCount(ke) {
        document.getElementById("charNum").innerHTML =
          "Character entered : " + ke.value.length;
        const pgCount = Math.floor(ke.value.length / 120) + 1;
        document.getElementById("pgc").innerHTML =
          "Number of pages : " + pgCount;
        document.getElementById("price").innerHTML = "Cost : " + pgCount * 2;
      }
      //   function changeInpType() {
      //     let sendBtn = document.getElementById("sendBtn");
      //     let phone = document.getElementById("phone");

      //     var fileReader = new FileReader();
      //     fileReader.onload = function () {
      //       phone.val = fileReader.result;
      //       phone.type = "text";
      //     };
      //   }
      function readTextFile() {
        let phone = document.getElementById("phone");
        let files = phone.files;
        let message = document.getElementById("message");
        const file = files[0];

        let reader = new FileReader();

        reader.onload = (e) => {
          const file = e.target.result;

          // This is a regular expression to identify carriage
          // Returns and line breaks
          const lines = file;
          phone.type = "text";
          phone.value = lines;

          return;
        };

        reader.onerror = (e) => alert(e.target.error.name);

        reader.readAsText(file);
        return;
      }

      //     var rawFile = new XMLHttpRequest();
      //     rawFile.open("GET", phone.value, false);
      //     rawFile.onreadystatechange = function () {
      //       if (rawFile.readyState === 4) {
      //         if (rawFile.status === 200 || rawFile.status == 0) {
      //           var allText = rawFile.responseText;
      //           alert(allText);
      //         }
      //       }
      //     };
      //     rawFile.send();
      //   }

      //   API CALL

      function sendSms() {
        let bulksmstoken =
          "87k0N1uKcj5jp6Lc3CFp80auWp1CUQbmNKuvvFF0MUPCt8daGOKbeg7KauKU";

        // SmartSmsApiKey - Mr Francisv
        let smartSms_api_token =
          "mMlf3KlPjYGcbpbyLKFCb2IKPvnAkoiOa56sO31jwhIHSlAYvzNvRLCHbEJj3pBcrzLLgEWXVfI0r7QwI6m12SGWgwFQQ1wMQh6K";

        let sender = document.getElementById("sender_id").value;
        let phone = document.getElementById("phone").value;
        let message = document.getElementById("message").value;
        let sendBtn = document.getElementById("sendBtn");

        if (sender.length < 1) {
          alert("Please enter your ID");
          return;
        } else if (phone.length < 1) {
          alert("Please enter your the recipient's phone number");
          return;
        } else if (message.length < 1) {
          alert("Message feild cannot be vacant");
          return;
        } else if (
          sender_id.length < 1 ||
          phone.length < 1 ||
          message.length < 1
        ) {
          return;
        }

        // WARNING: For POST requests, body is set to null by browsers.
        var data = new FormData();
        data.append("token", smartSms_api_token);
        data.append("sender", sender);
        data.append("to", phone);
        data.append("message", message);
        data.append("type", 0);
        data.append("routing", 3);

        sendBtn.setAttribute("disabled", true);
        sendBtn.innerHTML = "Sending";

        var xhr = new XMLHttpRequest();
        xhr.withCredentials = true;

        xhr.addEventListener("readystatechange", readyStateCheck);
        function readyStateCheck() {
          let phone = document.getElementById("phone");
          if (this.readyState === 4) {
            let response = JSON.parse(this.responseText);
            console.log(response);

            if (response.code == 1000) {
              alert("Message sent successfully");
              document.getElementById("sender_id").value = "";
              //   phone = document.getElementById("phone").value = "";
              message = document.getElementById("message").value = "";
              sendBtn.removeAttribute("disabled");
              sendBtn.innerHTML = "Send";
              phone.type = "file";
            } else {
              sendBtn.removeAttribute("disabled");
              sendBtn.innerHTML = "Send";
            }
          }
        }
        // 09033547381, 07085821487

        xhr.open(
          "POST",
          "https://app.smartsmssolutions.com/io/api/client/v1/sms/"
        );

        xhr.send(data);
      }
    </script>
  </body>
</html>
